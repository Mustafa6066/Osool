# üöÄ Osool Phase 1 Deployment Action Plan
**Target: Vercel Pro + Railway Pro**
**Phase: AI Chatting & Selling with AMR Agent**
**Date: January 2026**

---

## üìã Pre-Deployment Checklist

### ‚úÖ What You Have
- [x] Vercel Pro account
- [x] Railway Pro account
- [x] GitHub repository: `Mustafa6066/Osool`
- [x] AMR (Claude) AI Agent implementation
- [x] FastAPI backend with AI endpoints
- [x] Next.js frontend with chat interface
- [x] Supabase vector store for RAG

### üîë What You Need to Prepare
- [ ] OpenAI API Key (`OPENAI_API_KEY`)
- [ ] Anthropic API Key (`ANTHROPIC_API_KEY`) - for AMR
- [ ] Supabase URL and Key (for vector store)
- [ ] ThirdWeb Client ID (for wallet)
- [ ] JWT Secret Key (generate new)
- [ ] Wallet Encryption Key (generate new)

---

## üõ†Ô∏è Step 1: Generate Secure Production Keys

Run these commands locally and save the output securely:

### 1.1 Generate JWT Secret
```bash
# Windows (PowerShell)
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 64 | ForEach-Object {[char]$_})

# Linux/Mac
openssl rand -hex 32
```

### 1.2 Generate Wallet Encryption Key
```bash
python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
```

**IMPORTANT:** Save these in a secure password manager. You'll need them for Railway.

---

## üöÇ Step 2: Deploy Backend to Railway Pro

### 2.1 Create New Railway Project
1. Go to [Railway.app](https://railway.app/)
2. Click **"New Project"**
3. Select **"Deploy from GitHub repo"**
4. Choose: `Mustafa6066/Osool`
5. Click **"Deploy Now"**

### 2.2 Configure Service Settings
1. In Railway dashboard, click on your service
2. Go to **Settings** tab
3. Configure the following:

**Build Settings:**
- Root Directory: `backend`
- Watch Paths: `backend/**`
- Dockerfile Path: `backend/Dockerfile.prod`

**Service Settings:**
- Service Name: `osool-backend-prod`
- Start Command: *(Auto-detected from Dockerfile)*

### 2.3 Add PostgreSQL Database
1. In Railway project view, click **"New Service"**
2. Select **"Database"** ‚Üí **"PostgreSQL"**
3. Railway will automatically create `DATABASE_URL` variable

### 2.4 Configure Environment Variables

Go to **Variables** tab and add ALL of these:

#### Core Settings
```
ENVIRONMENT=production
PORT=8000
PYTHONPATH=/app
```

#### Database (Auto-generated by Railway)
```
DATABASE_URL=${{Postgres.DATABASE_URL}}
```

#### AI Configuration (CRITICAL for AMR)
```
OPENAI_API_KEY=sk-proj-YOUR_KEY_HERE
ANTHROPIC_API_KEY=sk-ant-api03-YOUR_KEY_HERE
CLAUDE_MODEL=claude-3-5-sonnet-20241022
CLAUDE_MAX_TOKENS=4096
CLAUDE_TEMPERATURE=0.3
```

#### Vector Store (Supabase)
```
SUPABASE_URL=https://YOUR_PROJECT.supabase.co
SUPABASE_KEY=YOUR_SUPABASE_ANON_KEY
```

#### Security Keys (Use generated values from Step 1)
```
JWT_SECRET_KEY=YOUR_GENERATED_JWT_SECRET
WALLET_ENCRYPTION_KEY=YOUR_GENERATED_FERNET_KEY
```

#### CORS (Will update after Vercel deployment)
```
FRONTEND_DOMAIN=http://localhost:3000
```

#### Optional: Monitoring
```
SENTRY_DSN=YOUR_SENTRY_DSN_IF_YOU_HAVE_ONE
LOG_LEVEL=info
```

### 2.5 Deploy and Verify
1. Click **"Deploy"** (Railway auto-deploys on variable changes)
2. Wait for build to complete (3-5 minutes)
3. Railway will provide a public URL: `https://osool-backend-production.up.railway.app`
4. Copy this URL for Step 3

### 2.6 Test Backend Health
Open in browser:
```
https://YOUR_RAILWAY_URL/health
```

Expected response:
```json
{
  "status": "healthy",
  "timestamp": "2026-01-13T...",
  "database": "connected",
  "ai_service": "ready"
}
```

---

## ‚ñ≤ Step 3: Deploy Frontend to Vercel Pro

### 3.1 Create New Vercel Project
1. Go to [Vercel.com](https://vercel.com/)
2. Click **"Add New"** ‚Üí **"Project"**
3. Import: `Mustafa6066/Osool`

### 3.2 Configure Project Settings

**Framework Preset:** Next.js
**Root Directory:** Click **"Edit"** ‚Üí Select **`web`** ‚ö†Ô∏è CRITICAL!

**Build Settings:**
- Build Command: `npm run build`
- Output Directory: `.next`
- Install Command: `npm install`

### 3.3 Add Environment Variables

Click **"Environment Variables"** and add:

```
NEXT_PUBLIC_API_URL=https://YOUR_RAILWAY_URL_HERE
NEXT_PUBLIC_THIRDWEB_CLIENT_ID=YOUR_THIRDWEB_CLIENT_ID
```

**IMPORTANT:**
- Replace `YOUR_RAILWAY_URL_HERE` with the URL from Step 2.5
- No trailing slash in the URL!

### 3.4 Deploy
1. Click **"Deploy"**
2. Wait for build (2-3 minutes)
3. Vercel provides a domain: `https://osool-web.vercel.app`

---

## üîó Step 4: Connect Services (CORS Configuration)

### 4.1 Update Backend CORS
1. Go back to **Railway** dashboard
2. Navigate to **Variables** tab
3. Update `FRONTEND_DOMAIN` to your Vercel URL:
   ```
   FRONTEND_DOMAIN=https://osool-web.vercel.app
   ```
4. Railway will auto-redeploy (takes 2-3 minutes)

### 4.2 Verify Connection
1. Open your Vercel URL in browser
2. Navigate to the Chat interface
3. Type: "Hello"
4. Expected: AMR agent responds with AI-powered reply

---

## üß™ Step 5: End-to-End Testing

### 5.1 Test AI Chat (AMR Agent)
1. Open `https://YOUR_VERCEL_URL`
2. Go to Chat section
3. Test queries:
   - "Show me properties in New Cairo"
   - "I want a villa under 5 million EGP"
   - "Tell me about property X"

**Expected Behavior:**
- AMR agent responds with intelligent, context-aware answers
- Retrieves property data from vector store
- Maintains conversation context

### 5.2 Test Authentication
1. Try to access protected endpoints
2. Sign up / Sign in flow
3. Verify JWT tokens are issued

### 5.3 Check Backend Logs
In Railway:
1. Go to **Deployments** tab
2. Click latest deployment
3. View logs for errors

---

## üìä Step 6: Set Up Monitoring

### 6.1 Railway Metrics
- Railway Pro provides built-in metrics
- Monitor CPU, Memory, Request count
- Set up alerts for high error rates

### 6.2 Vercel Analytics
- Go to Vercel dashboard ‚Üí Analytics
- Enable Web Analytics (included in Pro)
- Monitor page views, performance

### 6.3 Optional: Sentry Error Tracking
If you have Sentry:
1. Create project at [sentry.io](https://sentry.io)
2. Copy DSN
3. Add to Railway variables: `SENTRY_DSN=https://...`
4. Redeploy

---

## üéØ Step 7: Custom Domain (Optional)

### 7.1 Configure Vercel Domain
1. In Vercel project settings ‚Üí **Domains**
2. Add your domain (e.g., `osool.com`)
3. Update DNS records as instructed

### 7.2 Update Backend CORS
After domain is active:
```
FRONTEND_DOMAIN=https://osool.com
```

---

## üö® Troubleshooting Guide

### Problem: Frontend can't reach backend (404 or CORS error)

**Solution:**
1. Check `NEXT_PUBLIC_API_URL` in Vercel matches Railway URL exactly
2. Check `FRONTEND_DOMAIN` in Railway matches Vercel URL exactly
3. No trailing slashes in URLs!
4. Check browser console for exact error

### Problem: Backend returns 500 error

**Solution:**
1. Check Railway logs: Dashboard ‚Üí Deployments ‚Üí View Logs
2. Common causes:
   - Missing `DATABASE_URL`
   - Missing `OPENAI_API_KEY` or `ANTHROPIC_API_KEY`
   - Database connection failed
3. Verify all environment variables are set

### Problem: AI agent doesn't respond

**Solution:**
1. Verify `ANTHROPIC_API_KEY` is correct in Railway
2. Check Supabase variables are set correctly
3. Ensure vector store has data (run `ingest_data.py` locally)
4. Check Railway logs for API errors

### Problem: Build fails on Railway

**Solution:**
1. Check Dockerfile is valid: `backend/Dockerfile.prod`
2. Verify Root Directory is set to `backend`
3. Check `requirements.txt` for syntax errors
4. View build logs for specific error

### Problem: Build fails on Vercel

**Solution:**
1. Verify Root Directory is set to `web`
2. Check `package.json` exists in `web/` folder
3. Verify Node.js version compatibility
4. Check build logs for missing dependencies

---

## üìù Post-Deployment Checklist

- [ ] Backend health endpoint returns 200 OK
- [ ] Frontend loads successfully
- [ ] AI chat responds to queries
- [ ] Authentication flow works
- [ ] CORS is properly configured
- [ ] Monitoring is active
- [ ] Error tracking is enabled (if using Sentry)
- [ ] Environment variables are secure
- [ ] Database migrations ran successfully
- [ ] Vector store is populated with data

---

## üîê Security Notes

1. **Never commit `.env` files to Git**
2. **Rotate API keys regularly**
3. **Use Railway's built-in secrets management**
4. **Enable 2FA on Vercel and Railway accounts**
5. **Monitor API usage to prevent key theft**
6. **Set up rate limiting** (already configured in backend)

---

## üéâ Success Criteria

Your Phase 1 deployment is successful when:

‚úÖ User can access frontend at Vercel URL
‚úÖ Chat interface loads and connects to backend
‚úÖ AMR agent responds to property queries
‚úÖ Backend health endpoint is green
‚úÖ No CORS errors in browser console
‚úÖ Authentication works end-to-end
‚úÖ Railway and Vercel dashboards show healthy services

---

## üìû Need Help?

If you encounter issues:
1. Check Railway logs first
2. Check Vercel deployment logs
3. Review browser console for frontend errors
4. Verify all environment variables match this guide

---

## üöÄ Next Steps (Post-Deployment)

After successful Phase 1 deployment:

1. **Load Test**: Use tools like k6 or Artillery
2. **Custom Domain**: Set up your production domain
3. **CDN**: Vercel handles this automatically
4. **Database Backups**: Configure Railway automated backups
5. **CI/CD**: Set up GitHub Actions for automated deployments
6. **Phase 2**: Blockchain integration on Polygon mainnet

---

**Deployment Guide Version:** 1.0
**Last Updated:** January 13, 2026
**Maintained by:** Osool Engineering Team
